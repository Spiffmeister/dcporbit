# DCPORBIT.jl: DisContinuous Particle ORBIT

_Solving the equations of motion for charged particles in discontinuous fields._

The code has now been slightly extended to give the author a playground to experiment with some numerical implementations. Therefore, some scripts may not work.

## Features

`dcporbit.jl` solves the equations of motion of a charged particle in a magnetic field:

$$\begin{align} 
    \mathbf{x}          &= \dot{\mathbf{x}} \\
    \ddot{\mathbf{x}}   &= \dot{\mathbf{x}}\times \mathbf{B}(\mathbf{x},t)
\end{align}$$
where $\mathbf{B}$ may be discontinuous. Other features include:
- 4th order Runge-Kutta method with event location used for time integration.
- Integrate groups of particles by initialising them all at once.
- Current implementation is only in Cartesian coordinates.
- Can compute analytic solution in very limited cases.

This code was originally written for an honors thesis and to assist with implementation of a discontinuous ODE solver implemented in [VENUS-LEVIS](https://doi.org/10.1016/j.cpc.2014.08.007). Details on the routines and their implementation in VENUS-LEVIS can be found [here](https://doi.org/10.1016/j.cpc.2021.108191).


## Example usage

```julia
using dcporbit
```

```julia
x₀ = [0.,0.,0.]
v₀ = [1.,0.,0.]

t_f = 10.0
Δt = 1.e-3
```

Set up a magnetic field purely in the $\mathbf{z}$ direction and tell the code what the equations of motion are
```julia
Bfield(x,t) = [0.,0.,1.]

ODE = forces(Bfield)
```

Initialise a particle object in full orbit mode (note that `mode=GuidingCentre` is also possible)
```julia
mode = FullOrbit
p = particle(x₀,v₀,mode,Δt,Bfield)
```
Solve the particle orbit, this updates the `particle` object from above,
```julia
solve_orbit!(p,ODE,t_f,method=:RK4)
```



## Similar software

The most relevant code is [VENUS-LEVIS](https://doi.org/10.1016/j.cpc.2014.08.007), which computes particle orbits in a variety of magnetic field geometries, including discontinuous fields generated by the [Stepped Pressure Equilibrium Code](https://doi.org/10.1063/1.4765691).



## References


- D. Muir, D. Pfefferlé, Z. Qu, M. Hole, and M. Hegland, ‘Numerical integration of particle orbits in discontinuous fields using VENUS-LEVIS and SPEC’, Computer Physics Communications, p. 108191, Oct. 2021, doi: [10.1016/j.cpc.2021.108191](https://www.sciencedirect.com/science/article/pii/S0010465521003039).

- D. Pfefferlé, W. A. Cooper, J. P. Graves, and C. Misev, ‘VENUS-LEVIS and its spline-Fourier interpolation of 3D toroidal magnetic field representation for guiding-centre and full-orbit simulations of charged energetic particles’, Computer Physics Communications, vol. 185, no. 12, pp. 3127–3140, Dec. 2014, doi: [10.1016/j.cpc.2014.08.007](http://www.sciencedirect.com/science/article/pii/S0010465514002744).

- S. R. Hudson et al., ‘Computation of multi-region relaxed magnetohydrodynamic equilibria’, Physics of Plasmas, vol. 19, no. 11, p. 112502, Nov. 2012, doi: [10.1063/1.4765691](http://aip.scitation.org/doi/10.1063/1.4765691).